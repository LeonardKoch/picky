(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _picky = require('./lib/picky.js');

var _picky2 = _interopRequireDefault(_picky);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

},{"./lib/picky.js":2}],2:[function(require,module,exports){
'use strict';

var _typeof21 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

var _typeof20 = typeof Symbol === "function" && _typeof21(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof21(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof21(obj);
};

var _typeof19 = typeof Symbol === "function" && _typeof20(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof20(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof20(obj);
};

var _typeof18 = typeof Symbol === "function" && _typeof19(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof19(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof19(obj);
};

var _typeof17 = typeof Symbol === "function" && _typeof18(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof18(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof18(obj);
};

var _typeof16 = typeof Symbol === "function" && _typeof17(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof17(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof17(obj);
};

var _typeof15 = typeof Symbol === "function" && _typeof16(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof16(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof16(obj);
};

var _typeof14 = typeof Symbol === "function" && _typeof15(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof15(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof15(obj);
};

var _typeof13 = typeof Symbol === "function" && _typeof14(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof14(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof14(obj);
};

var _typeof12 = typeof Symbol === "function" && _typeof13(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof13(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof13(obj);
};

var _typeof11 = typeof Symbol === "function" && _typeof12(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof12(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof12(obj);
};

var _typeof10 = typeof Symbol === "function" && _typeof11(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof11(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof11(obj);
};

var _typeof9 = typeof Symbol === "function" && _typeof10(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof10(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof10(obj);
};

var _typeof8 = typeof Symbol === "function" && _typeof9(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof9(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof9(obj);
};

var _typeof7 = typeof Symbol === "function" && _typeof8(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof8(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof8(obj);
};

var _typeof6 = typeof Symbol === "function" && _typeof7(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof7(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof7(obj);
};

var _typeof5 = typeof Symbol === "function" && _typeof6(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof6(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof6(obj);
};

var _typeof4 = typeof Symbol === "function" && _typeof5(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof5(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof5(obj);
};

var _typeof3 = typeof Symbol === "function" && _typeof4(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof4(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof4(obj);
};

var _typeof2 = typeof Symbol === "function" && _typeof3(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof3(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof3(obj);
};

var _typeof = typeof Symbol === "function" && _typeof2(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof2(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof2(obj);
};

var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
        var source = arguments[i];for (var key in source) {
            if (Object.prototype.hasOwnProperty.call(source, key)) {
                target[key] = source[key];
            }
        }
    }return target;
};

var _createClass = function () {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
        }
    }return function (Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
    };
}();

var _viewDataHelpers = require('./viewDataHelpers.js');

var _viewDataHelpers2 = _interopRequireDefault(_viewDataHelpers);

var _util = require('./util.js');

var _util2 = _interopRequireDefault(_util);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function _toConsumableArray(arr) {
    if (Array.isArray(arr)) {
        for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
            arr2[i] = arr[i];
        }return arr2;
    } else {
        return Array.from(arr);
    }
}

function _defineProperty(obj, key, value) {
    if (key in obj) {
        Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });
    } else {
        obj[key] = value;
    }return obj;
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var picky = function () {
    function picky() {
        _classCallCheck(this, picky);
    }

    _createClass(picky, null, [{
        key: 'addCalendar',
        value: function addCalendar(state, name, startDay, startMonth, startYear) {
            if (picky.isValidPicky(state)) {
                var currentDate = new Date();

                return _extends({}, state, {
                    calendars: _extends({}, state.calendars, _defineProperty({}, name, {
                        name: name,
                        view: {
                            year: startYear || currentDate.getFullYear(),
                            month: startMonth || currentDate.getMonth() + 1,
                            day: startDay || currentDate.getDate()
                        },
                        selection: {
                            year: startYear || currentDate.getFullYear(),
                            month: startMonth || currentDate.getMonth() + 1,
                            day: startDay || currentDate.getDate()
                        }
                    }))
                });
            } else {
                return state;
            }
        }
    }, {
        key: 'constrainViewToView',
        value: function constrainViewToView(state, agentCalendarName, gateCalendarName, comparator, behaviour) {
            return picky.addCalendarConstraint(state, agentCalendarName, 'view', gateCalendarName, 'view', comparator, behaviour);
        }
    }, {
        key: 'constrainViewToSelection',
        value: function constrainViewToSelection(state, agentCalendarName, gateCalendarName, comparator, behaviour) {
            return picky.addCalendarConstraint(state, agentCalendarName, 'view', gateCalendarName, 'selection', comparator, behaviour);
        }
    }, {
        key: 'constrainSelectionToView',
        value: function constrainSelectionToView(state, agentCalendarName, gateCalendarName, comparator, behaviour) {
            return picky.addCalendarConstraint(state, agentCalendarName, 'selection', gateCalendarName, 'view', comparator, behaviour);
        }
    }, {
        key: 'constrainSelectionToSelection',
        value: function constrainSelectionToSelection(state, agentCalendarName, gateCalendarName, comparator, behaviour) {
            return picky.addCalendarConstraint(state, agentCalendarName, 'selection', gateCalendarName, 'selection', comparator, behaviour);
        }
    }, {
        key: 'constrainViewToDate',
        value: function constrainViewToDate(state, agentCalendarName, date, comparator, behaviour, keepLive) {
            return picky.addCalendarConstraint(state, agentCalendarName, 'selection', keepLive ? date : Object.assign({}, date), comparator, behaviour);
        }
    }, {
        key: 'constrainSelectionToDate',
        value: function constrainSelectionToDate(state, agentCalendarName, date, comparator, behaviour, keepLive) {
            return picky.addCalendarConstraint(state, agentCalendarName, 'selection', keepLive ? date : Object.assign({}, date), comparator, behaviour);
        }
    }, {
        key: 'addCalendarConstraint',
        value: function addCalendarConstraint(state, agentCalendarName, agentProperty, gateCalendarName, gateProperty) {
            var comparator = arguments.length <= 5 || arguments[5] === undefined ? '<=' : arguments[5];
            var behaviour = arguments.length <= 6 || arguments[6] === undefined ? 'limit' : arguments[6];

            return picky.addConstraint(state, {
                agent: {
                    calendar: agentCalendarName,
                    property: agentProperty
                },
                gate: {
                    type: 'calendar',
                    calendar: gateCalendarName,
                    property: gateProperty
                },
                comparator: comparator,
                behaviour: behaviour
            });
        }
    }, {
        key: 'addDateConstraint',
        value: function addDateConstraint(state, agentCalendarName, agentProperty, date) {
            var comparator = arguments.length <= 4 || arguments[4] === undefined ? '<=' : arguments[4];
            var behaviour = arguments.length <= 5 || arguments[5] === undefined ? 'limit' : arguments[5];

            return picky.addConstraint(state, {
                agent: {
                    calendar: agentCalendarName,
                    property: agentProperty
                },
                gate: {
                    type: 'date',
                    date: date
                },
                comparator: comparator,
                behaviour: behaviour
            });
        }
    }, {
        key: 'addConstraint',
        value: function addConstraint(state, constraint) {
            if (picky.isValidPicky(state)) {
                return _extends({}, state, {
                    constraints: [].concat(_toConsumableArray(state.constraints), [constraint])
                });
            } else {
                return state;
            }
        }
    }, {
        key: 'setCalendar',
        value: function setCalendar(state, name, calendar) {
            if (picky.isValidPicky(state)) {
                return _extends({}, state, {
                    calendars: _extends({}, state.calendars, _defineProperty({}, name, calendar))
                });
            } else {
                return state;
            }
        }
    }, {
        key: 'getGateValue',
        value: function getGateValue(state, constraint) {
            var gate = constraint.gate;
            switch (gate.type) {
                case 'calendar':
                    return state.calendars[gate.calendar][gate.property];
                    break;
                case 'date':
                    return gate.date;
                    break;
            }
        }
    }, {
        key: 'checkConstraintViolation',
        value: function checkConstraintViolation(state, constraint, calendar, property, value) {
            if (constraint.agent.calendar === calendar && constraint.agent.property === property) {
                // Is applicable constraint
                var constraintValue = picky.getGateValue(state, constraint);

                var valueBeforeGate = _util2.default.aBeforeB(value, constraintValue);
                var valueAfterGate = _util2.default.aAfterB(value, constraintValue);
                var valueEqualGate = !valueBeforeGate && !valueAfterGate;

                var valueIsValid = void 0;
                switch (constraint.comparator) {
                    case '<':
                        valueIsValid = valueBeforeGate;
                        break;
                    case '<=':
                        valueIsValid = valueBeforeGate || valueEqualGate;
                        break;
                    case '>':
                        valueIsValid = valueAfterGate;
                        break;
                    case '>=':
                        valueIsValid = valueAfterGate || valueEqualGate;
                        break;
                    case '=':
                    case '==':
                    case '===':
                        valueIsValid = valueEqualGate;
                        break;
                    case '!=':
                    case '!==':
                        valueIsValid = !valueEqualGate;
                        break;
                    default:
                        valueIsValid = false;
                }

                if (valueIsValid) {
                    // Value doesn't violate constraint.
                    return value;
                } else {
                    switch (constraint.behaviour) {
                        case 'limit':
                            // Return a copy of the constrained value.
                            return Object.assign({}, constraintValue);
                            break;
                        case 'cancel':
                            return Object.assign({}, state.calendars[calendar][property]);
                            break;
                        default:
                            return Object.assign({}, state.calendars[calendar][property]);
                    }
                }
            } else {
                // Is not applicable constraint
                return value;
            }
        }
    }, {
        key: 'validateChangeAgainstConstraints',
        value: function validateChangeAgainstConstraints(state, calendarName, property, value) {
            return state.constraints.reduce(function (currentView, constraint) {
                return picky.checkConstraintViolation(state, constraint, calendarName, property, currentView);
            }, value);
        }
    }, {
        key: 'setCalendarView',
        value: function setCalendarView(state, calendarName, view) {
            if (picky.isValidPicky(state)) {
                var constrainedView = picky.validateChangeAgainstConstraints(state, calendarName, 'view', view);

                return picky.setCalendar(state, calendarName, _extends({}, state.calendars[calendarName], {
                    view: constrainedView
                }));
            } else {
                return state;
            }
        }
    }, {
        key: 'setCalendarViewDay',
        value: function setCalendarViewDay(state, name, day) {
            if (picky.isValidPicky(state)) {
                return picky.setCalendarView(state, name, _extends({}, state.calendars[name].view, {
                    day: day
                }));
            } else {
                return state;
            }
        }
    }, {
        key: 'setCalendarViewMonth',
        value: function setCalendarViewMonth(state, name, month) {
            if (picky.isValidPicky(state)) {
                return picky.setCalendarView(state, name, _extends({}, state.calendars[name].view, {
                    month: month
                }));
            } else {
                return state;
            }
        }
    }, {
        key: 'setCalendarViewYear',
        value: function setCalendarViewYear(state, name, year) {
            if (picky.isValidPicky(state)) {
                return picky.setCalendarView(state, name, _extends({}, state.calendars[name].view, {
                    year: year
                }));
            } else {
                return state;
            }
        }
    }, {
        key: 'setCalendarSelection',
        value: function setCalendarSelection(state, name, selection) {
            if (picky.isValidPicky(state)) {
                return picky.setCalendar(state, name, _extends({}, state.calendars[name], {
                    selection: selection
                }));
            } else {
                return state;
            }
        }
    }, {
        key: 'setCalendarSelectionDay',
        value: function setCalendarSelectionDay(state, name, day) {
            if (picky.isValidPicky(state)) {
                return picky.setCalendarSelection(state, name, _extends({}, state.calendars[name].selection, {
                    day: day
                }));
            } else {
                return state;
            }
        }
    }, {
        key: 'setCalendarSelectionMonth',
        value: function setCalendarSelectionMonth(state, name, month) {
            if (picky.isValidPicky(state)) {
                return picky.setCalendarSelection(state, name, _extends({}, state.calendars[name].selection, {
                    month: month
                }));
            } else {
                return state;
            }
        }
    }, {
        key: 'setCalendarSelectionYear',
        value: function setCalendarSelectionYear(state, name, year) {
            if (picky.isValidPicky(state)) {
                return picky.setCalendarSelection(state, name, _extends({}, state.calendars[name].selection, {
                    year: year
                }));
            } else {
                return state;
            }
        }
    }, {
        key: 'isValidPicky',
        value: function isValidPicky(state) {
            if ((typeof state === 'undefined' ? 'undefined' : _typeof(state)) === _typeof({}) && _typeof(state.calendars) === _typeof([])) {
                return true;
            } else {
                console.warn('No valid picky data passed in.');
                return false;
            }
        }
    }, {
        key: 'getCalendarMonthViewData',
        value: function getCalendarMonthViewData(state, name) {
            if (picky.isValidPicky(state)) {
                var calendar = state.calendars[name];
                if (calendar) {
                    return _viewDataHelpers2.default.generateMonthViewData(calendar.view.month, calendar.view.year);
                } else {
                    console.warn('There is no calendar with the name: ' + name + ' in this picky object.');
                    return state;
                }
            } else {
                return state;
            }
        }
    }, {
        key: 'getCalendarYearViewData',
        value: function getCalendarYearViewData(state, name) {
            if (picky.isValidPicky(state)) {
                var calendar = state.calendars[name];
                if (calendar) {
                    return _viewDataHelpers2.default.generateYearViewData(calendar.view.year);
                } else {
                    console.warn('There is no calendar with the name: ' + name + ' in this picky object.');
                    return state;
                }
            } else {
                return state;
            }
        }
    }, {
        key: 'moveCalendarViewForwardOneMonth',
        value: function moveCalendarViewForwardOneMonth(state, name) {
            if (picky.isValidPicky(state)) {
                var calendar = state.calendars[name];
                if (calendar) {
                    return picky.setCalendarView(state, name, _util2.default.getDateOfFollowingMonth(calendar.view));
                } else {
                    console.warn('There is no calendar with the name: ' + name + ' in this picky object.');
                    return state;
                }
            } else {
                return state;
            }
        }
    }, {
        key: 'moveCalendarViewBackwardOneMonth',
        value: function moveCalendarViewBackwardOneMonth(state, name) {
            if (picky.isValidPicky(state)) {
                var calendar = state.calendars[name];
                if (calendar) {
                    return picky.setCalendarView(state, name, _util2.default.getDateOfPrecedingMonth(calendar.view));
                } else {
                    console.warn('There is no calendar with the name: ' + name + ' in this picky object.');
                    return state;
                }
            } else {
                return state;
            }
        }
    }, {
        key: 'getCalendarViewData',
        value: function getCalendarViewData(state, name) {
            if (picky.isValidPicky(state)) {
                var calendar = state.calendars[name];
                if (calendar) {
                    return _viewDataHelpers2.default.generateMonthViewData(calendar.view.month, calendar.view.year, null);
                } else {
                    console.warn('There is no calendar with the name: ' + name + ' in this picky object.');
                    return null;
                }
            } else {
                return null;
            }
        }
    }, {
        key: 'create',
        value: function create() {
            return {
                calendars: {},
                constraints: [],
                viewMode: 'month'
            };
        }
    }]);

    return picky;
}();

module.exports = picky;

},{"./util.js":3,"./viewDataHelpers.js":4}],3:[function(require,module,exports){
"use strict";

var _createClass = function () {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
        }
    }return function (Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
    };
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var util = function () {
    function util() {
        _classCallCheck(this, util);
    }

    _createClass(util, null, [{
        key: "isLeapYear",
        value: function isLeapYear(year) {
            if (year % 4 !== 0) {
                return false;
            } else if (year % 100 !== 0) {
                return true;
            } else if (year % 400 !== 0) {
                return false;
            } else {
                return true;
            }
        }
    }, {
        key: "aBeforeB",
        value: function aBeforeB(a, b) {
            return a.year < b.year || a.year === b.year && a.month < b.month || a.year === b.year && a.month === b.month && a.day < b.day;
        }
    }, {
        key: "aAfterB",
        value: function aAfterB(a, b) {
            return a.year > b.year || a.year === b.year && a.month > b.month || a.year === b.year && a.month === b.month && a.day > b.day;
        }
    }, {
        key: "getWeekday",
        value: function getWeekday(day, month, year) {
            // Implementing Zeller's congruence
            // https://en.wikipedia.org/wiki/Zeller%27s_congruence

            var q = day;
            var m = void 0;
            var potentiallyShiftedYear = void 0;
            if (month <= 2) {
                m = month + 12;
                potentiallyShiftedYear = year - 1;
            } else {
                m = month;
                potentiallyShiftedYear = year;
            }
            var K = potentiallyShiftedYear % 100;
            var J = Math.floor(potentiallyShiftedYear / 100);

            var h = (q + Math.floor(13 * (m + 1) / 5) + K + Math.floor(K / 4) + Math.floor(J / 4) + 5 * J) % 7;

            var d = (h + 5) % 7;
            return d;
        }
    }, {
        key: "getFollowingMonthNumber",
        value: function getFollowingMonthNumber(month) {
            if (month === 12) {
                return 1;
            } else {
                return month + 1;
            }
        }
    }, {
        key: "getPrecedingMonthNumber",
        value: function getPrecedingMonthNumber(month) {
            if (month === 1) {
                return 12;
            } else {
                return month - 1;
            }
        }
    }, {
        key: "getDateOfFollowingMonth",
        value: function getDateOfFollowingMonth(date) {
            var followingMonth = util.getFollowingMonthNumber(date.month);
            var yearOfFollowingMonth = followingMonth === 1 ? date.year + 1 : date.year;

            return {
                day: Math.min(date.day, util.getDaysInMonth(followingMonth, yearOfFollowingMonth)),
                month: followingMonth,
                year: yearOfFollowingMonth
            };
        }
    }, {
        key: "getDateOfPrecedingMonth",
        value: function getDateOfPrecedingMonth(date) {
            var precedingMonth = util.getPrecedingMonthNumber(date.month);
            var yearOfPrecedingMonth = precedingMonth === 12 ? date.year - 1 : date.year;

            return {
                day: Math.min(date.day, util.getDaysInMonth(precedingMonth, yearOfPrecedingMonth)),
                month: precedingMonth,
                year: yearOfPrecedingMonth
            };
        }
    }, {
        key: "getDaysInMonth",
        value: function getDaysInMonth(month, year) {
            var monthLengths = [31, util.isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            return monthLengths[month - 1];
        }
    }]);

    return util;
}();

module.exports = util;

},{}],4:[function(require,module,exports){
"use strict";

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _util = require("./util");

var _util2 = _interopRequireDefault(_util);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var viewDataHelpers = function () {
    function viewDataHelpers() {
        _classCallCheck(this, viewDataHelpers);
    }

    _createClass(viewDataHelpers, null, [{
        key: "createDayObject",
        value: function createDayObject(day, weekday, month, year, constraints) {

            var dayObj = {
                day: day, weekday: weekday, month: month, year: year
            };

            viewDataHelpers.getDateComparatives();

            return dayObj;
        }
    }, {
        key: "generateYearViewData",
        value: function generateYearViewData(year) {
            var isLeapYear = _util2.default.isLeapYear(year);
            return {
                year: year,
                isLeapYear: isLeapYear,
                numberOfDays: isLeapYear ? 366 : 365,
                months: new Array(12).fill(0).map(function (value, index) {
                    return index + 1;
                }).map(function (monthNumber) {
                    return viewDataHelpers.generateMonthViewData(monthNumber, year);
                })
            };
        }
    }, {
        key: "getDateComparatives",
        value: function getDateComparatives(date, constraints) {
            // Implement stuff from checkConstraintViolation
            // return
        }
    }, {
        key: "generateMonthViewData",
        value: function generateMonthViewData(month, year, constraints) {
            var startWeekday = _util2.default.getWeekday(1, month, year);

            var precedingMonth = _util2.default.getPrecedingMonthNumber(month);
            var yearOfPrecedingMonth = precedingMonth === 12 ? year - 1 : year;
            var daysInPrecedingMonth = _util2.default.getDaysInMonth(precedingMonth, year);

            var followingMonth = _util2.default.getFollowingMonthNumber(month);
            var yearOfFollowingMonth = followingMonth === 1 ? year + 1 : year;

            var daysInCurrentMonth = _util2.default.getDaysInMonth(month, year);

            var weeks = [];

            var currentDate = 1;
            var currentWeekIndex = 0;
            var currentDayInFollowingMonth = 1;

            weeks[currentWeekIndex] = [];

            for (var i = 0; i < startWeekday; i++) {
                weeks[currentWeekIndex].push(viewDataHelpers.createDayObject(daysInPrecedingMonth - startWeekday + 1 + i, i, precedingMonth, yearOfPrecedingMonth, constraints));
            }
            while (weeks[currentWeekIndex].length < 7 || currentDate <= daysInCurrentMonth) {
                if (weeks[currentWeekIndex].length === 7) {
                    currentWeekIndex++;
                    weeks[currentWeekIndex] = [];
                }
                if (currentDate <= daysInCurrentMonth) {
                    weeks[currentWeekIndex].push(viewDataHelpers.createDayObject(currentDate, weeks[currentWeekIndex].length + 1, month, year, constraints));
                    currentDate++;
                } else {
                    weeks[currentWeekIndex].push(viewDataHelpers.createDayObject(currentDayInFollowingMonth, weeks[currentWeekIndex].length + 1, followingMonth, yearOfFollowingMonth, constraints));
                    currentDayInFollowingMonth++;
                }
            }
            return {
                month: month,
                year: year,
                weeks: weeks
            };
        }
    }]);

    return viewDataHelpers;
}();

module.exports = viewDataHelpers;

},{"./util":3}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC5qcyIsImxpYlxccGlja3kuanMiLCJsaWJcXHV0aWwuanMiLCJsaWJcXHZpZXdEYXRhSGVscGVycy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7Ozs7Ozs7QUNBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7Ozs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SSxBQUVNOzs7Ozs7O29DLEFBRWlCLE8sQUFBTyxNLEFBQU0sVSxBQUFVLFksQUFBWSxXQUFXLEFBQzVEO2dCQUFJLE1BQUEsQUFBTSxhQUFWLEFBQUksQUFBbUIsUUFBUSxBQUM1QjtvQkFBTSxjQUFjLElBQXBCLEFBQW9CLEFBQUksQUFFeEI7O29DQUFBLEFBQ087NENBRUksTUFEUCxBQUNhLCtCQURiLEFBRVM7OEJBQVEsQUFDSCxBQUNOOztrQ0FDVSxhQUFhLFlBRGpCLEFBQ2lCLEFBQVksQUFDL0I7bUNBQU8sY0FBYyxZQUFBLEFBQVksYUFGL0IsQUFFNEMsQUFDOUM7aUNBQUssWUFBWSxZQUxaLEFBRUgsQUFDRixBQUVpQixBQUFZLEFBRWpDOzs7a0NBQ1UsYUFBYSxZQURaLEFBQ1ksQUFBWSxBQUMvQjttQ0FBTyxjQUFjLFlBQUEsQUFBWSxhQUYxQixBQUV1QyxBQUM5QztpQ0FBSyxZQUFZLFlBakJwQyxBQUdHLEFBRUksQUFFaUIsQUFDVCxBQU1XLEFBQ1AsQUFFaUIsQUFBWSxBQUtoRDs7OzttQkFBTSxBQUNIO3VCQUFBLEFBQU8sQUFDVixBQUNKOzs7Ozs0QyxBQUUwQixPLEFBQU8sbUIsQUFBbUIsa0IsQUFBa0IsWSxBQUFZLFdBQVcs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WUFBcEIsRUFBa0MsR0FBbEMsRUFBdUM7QUFDbkMsc0JBQU0sZ0JBQU4sRUFBd0IsSUFBeEIsQ0FBNkIsZ0JBQWdCLGVBQWhCLENBQ3pCLHVCQUF1QixZQUF2QixHQUFzQyxDQUF0QyxHQUEwQyxDQURqQixFQUV6QixDQUZ5QixFQUd6QixjQUh5QixFQUl6QixvQkFKeUIsRUFLekIsV0FMeUIsQ0FBN0I7QUFPSDtBQUNELG1CQUFNLE1BQU0sZ0JBQU4sRUFBd0IsTUFBeEIsR0FBaUMsQ0FBakMsSUFBc0MsZUFBZSxrQkFBM0QsRUFBK0U7QUFDM0Usb0JBQUcsTUFBTSxnQkFBTixFQUF3QixNQUF4QixLQUFtQyxDQUF0QyxFQUF5QztBQUNyQztBQUNBLDBCQUFNLGdCQUFOLElBQTBCLEVBQTFCO0FBQ0g7QUFDRCxvQkFBRyxlQUFlLGtCQUFsQixFQUFzQztBQUNsQywwQkFBTSxnQkFBTixFQUF3QixJQUF4QixDQUE2QixnQkFBZ0IsZUFBaEIsQ0FDekIsV0FEeUIsRUFFekIsTUFBTSxnQkFBTixFQUF3QixNQUF4QixHQUErQixDQUZOLEVBR3pCLEtBSHlCLEVBSXpCLElBSnlCLEVBS3pCLFdBTHlCLENBQTdCO0FBT0E7QUFDSCxpQkFURCxNQVNPO0FBQ0gsMEJBQU0sZ0JBQU4sRUFBd0IsSUFBeEIsQ0FBNkIsZ0JBQWdCLGVBQWhCLENBQ3pCLDBCQUR5QixFQUV6QixNQUFNLGdCQUFOLEVBQXdCLE1BQXhCLEdBQStCLENBRk4sRUFHekIsY0FIeUIsRUFJekIsb0JBSnlCLEVBS3pCLFdBTHlCLENBQTdCO0FBT0E7QUFDSDtBQUNKO0FBQ0QsbUJBQU87QUFDSCx1QkFBTyxLQURKO0FBRUgsc0JBQU0sSUFGSDtBQUdILHVCQUFPO0FBSEosYUFBUDtBQUtIOzs7Ozs7QUFHTCxPQUFPLE9BQVAsR0FBaUIsZUFBakIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHBpY2t5IGZyb20gJy4vbGliL3BpY2t5LmpzJzsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5pbXBvcnQgdmlld0RhdGFIZWxwZXJzIGZyb20gJy4vdmlld0RhdGFIZWxwZXJzLmpzJztcclxuaW1wb3J0IHV0aWwgZnJvbSAnLi91dGlsLmpzJztcclxuXHJcbmNsYXNzIHBpY2t5IHtcclxuXHJcbiAgICBzdGF0aWMgYWRkQ2FsZW5kYXIoc3RhdGUsIG5hbWUsIHN0YXJ0RGF5LCBzdGFydE1vbnRoLCBzdGFydFllYXIpIHtcclxuICAgICAgICAgaWYgKHBpY2t5LmlzVmFsaWRQaWNreShzdGF0ZSkpIHtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgY2FsZW5kYXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4uc3RhdGUuY2FsZW5kYXJzLFxyXG4gICAgICAgICAgICAgICAgICAgIC4uLntbbmFtZV0gOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHllYXI6IHN0YXJ0WWVhciB8fCBjdXJyZW50RGF0ZS5nZXRGdWxsWWVhcigpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9udGg6IHN0YXJ0TW9udGggfHwgY3VycmVudERhdGUuZ2V0TW9udGgoKSArIDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXk6IHN0YXJ0RGF5IHx8IGN1cnJlbnREYXRlLmdldERhdGUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHllYXI6IHN0YXJ0WWVhciB8fCBjdXJyZW50RGF0ZS5nZXRGdWxsWWVhcigpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9udGg6IHN0YXJ0TW9udGggfHwgY3VycmVudERhdGUuZ2V0TW9udGgoKSArIDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXk6IHN0YXJ0RGF5IHx8IGN1cnJlbnREYXRlLmdldERhdGUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfX1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjb25zdHJhaW5WaWV3VG9WaWV3KHN0YXRlLCBhZ2VudENhbGVuZGFyTmFtZSwgZ2F0ZUNhbGVuZGFyTmFtZSwgY29tcGFyYXRvciwgYmVoYXZpb3VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHBpY2t5LmFkZENhbGVuZGFyQ29uc3RyYWludChzdGF0ZSwgYWdlbnRDYWxlbmRhck5hbWUsICd2aWV3JywgZ2F0ZUNhbGVuZGFyTmFtZSwgJ3ZpZXcnLCBjb21wYXJhdG9yLCBiZWhhdmlvdXIpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGNvbnN0cmFpblZpZXdUb1NlbGVjdGlvbihzdGF0ZSwgYWdlbnRDYWxlbmRhck5hbWUsIGdhdGVDYWxlbmRhck5hbWUsIGNvbXBhcmF0b3IsIGJlaGF2aW91cikge1xyXG4gICAgICAgIHJldHVybiBwaWNreS5hZGRDYWxlbmRhckNvbnN0cmFpbnQoc3RhdGUsIGFnZW50Q2FsZW5kYXJOYW1lLCAndmlldycsIGdhdGVDYWxlbmRhck5hbWUsICdzZWxlY3Rpb24nLCBjb21wYXJhdG9yLCBiZWhhdmlvdXIpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGNvbnN0cmFpblNlbGVjdGlvblRvVmlldyhzdGF0ZSwgYWdlbnRDYWxlbmRhck5hbWUsIGdhdGVDYWxlbmRhck5hbWUsIGNvbXBhcmF0b3IsIGJlaGF2aW91cikge1xyXG4gICAgICAgIHJldHVybiBwaWNreS5hZGRDYWxlbmRhckNvbnN0cmFpbnQoc3RhdGUsIGFnZW50Q2FsZW5kYXJOYW1lLCAnc2VsZWN0aW9uJywgZ2F0ZUNhbGVuZGFyTmFtZSwgJ3ZpZXcnLCBjb21wYXJhdG9yLCBiZWhhdmlvdXIpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGNvbnN0cmFpblNlbGVjdGlvblRvU2VsZWN0aW9uKHN0YXRlLCBhZ2VudENhbGVuZGFyTmFtZSwgZ2F0ZUNhbGVuZGFyTmFtZSwgY29tcGFyYXRvciwgYmVoYXZpb3VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHBpY2t5LmFkZENhbGVuZGFyQ29uc3RyYWludChzdGF0ZSwgYWdlbnRDYWxlbmRhck5hbWUsICdzZWxlY3Rpb24nLCBnYXRlQ2FsZW5kYXJOYW1lLCAnc2VsZWN0aW9uJywgY29tcGFyYXRvciwgYmVoYXZpb3VyKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY29uc3RyYWluVmlld1RvRGF0ZShzdGF0ZSwgYWdlbnRDYWxlbmRhck5hbWUsIGRhdGUsIGNvbXBhcmF0b3IsIGJlaGF2aW91ciwga2VlcExpdmUpIHtcclxuICAgICAgICByZXR1cm4gcGlja3kuYWRkQ2FsZW5kYXJDb25zdHJhaW50KHN0YXRlLCBhZ2VudENhbGVuZGFyTmFtZSwgJ3NlbGVjdGlvbicsIGtlZXBMaXZlID8gZGF0ZSA6IE9iamVjdC5hc3NpZ24oe30sIGRhdGUpLCBjb21wYXJhdG9yLCBiZWhhdmlvdXIpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGNvbnN0cmFpblNlbGVjdGlvblRvRGF0ZShzdGF0ZSwgYWdlbnRDYWxlbmRhck5hbWUsIGRhdGUsIGNvbXBhcmF0b3IsIGJlaGF2aW91ciwga2VlcExpdmUpIHtcclxuICAgICAgICByZXR1cm4gcGlja3kuYWRkQ2FsZW5kYXJDb25zdHJhaW50KHN0YXRlLCBhZ2VudENhbGVuZGFyTmFtZSwgJ3NlbGVjdGlvbicsIGtlZXBMaXZlID8gZGF0ZSA6IE9iamVjdC5hc3NpZ24oe30sIGRhdGUpLCBjb21wYXJhdG9yLCBiZWhhdmlvdXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhZGRDYWxlbmRhckNvbnN0cmFpbnQoc3RhdGUsIGFnZW50Q2FsZW5kYXJOYW1lLCBhZ2VudFByb3BlcnR5LCBnYXRlQ2FsZW5kYXJOYW1lLCBnYXRlUHJvcGVydHksIGNvbXBhcmF0b3IgPSAnPD0nLCBiZWhhdmlvdXIgPSAnbGltaXQnKSB7XHJcbiAgICAgICAgcmV0dXJuIHBpY2t5LmFkZENvbnN0cmFpbnQoc3RhdGUsIHtcclxuICAgICAgICAgICAgYWdlbnQ6IHtcclxuICAgICAgICAgICAgICAgIGNhbGVuZGFyOiBhZ2VudENhbGVuZGFyTmFtZSxcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5OiBhZ2VudFByb3BlcnR5XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGdhdGU6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdjYWxlbmRhcicsXHJcbiAgICAgICAgICAgICAgICBjYWxlbmRhcjogZ2F0ZUNhbGVuZGFyTmFtZSxcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5OiBnYXRlUHJvcGVydHlcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29tcGFyYXRvcjogY29tcGFyYXRvcixcclxuICAgICAgICAgICAgYmVoYXZpb3VyOiBiZWhhdmlvdXJcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYWRkRGF0ZUNvbnN0cmFpbnQoc3RhdGUsIGFnZW50Q2FsZW5kYXJOYW1lLCBhZ2VudFByb3BlcnR5LCBkYXRlLCBjb21wYXJhdG9yID0gJzw9JywgYmVoYXZpb3VyID0gJ2xpbWl0Jykge1xyXG4gICAgICAgIHJldHVybiBwaWNreS5hZGRDb25zdHJhaW50KHN0YXRlLCB7XHJcbiAgICAgICAgICAgIGFnZW50OiB7XHJcbiAgICAgICAgICAgICAgICBjYWxlbmRhcjogYWdlbnRDYWxlbmRhck5hbWUsXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eTogYWdlbnRQcm9wZXJ0eVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnYXRlOiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnZGF0ZScsXHJcbiAgICAgICAgICAgICAgICBkYXRlOiBkYXRlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbXBhcmF0b3I6IGNvbXBhcmF0b3IsXHJcbiAgICAgICAgICAgIGJlaGF2aW91cjogYmVoYXZpb3VyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFkZENvbnN0cmFpbnQoc3RhdGUsIGNvbnN0cmFpbnQpIHtcclxuICAgICAgICAgaWYgKHBpY2t5LmlzVmFsaWRQaWNreShzdGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgY29uc3RyYWludHM6IFtcclxuICAgICAgICAgICAgICAgICAgICAuLi5zdGF0ZS5jb25zdHJhaW50cyxcclxuICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW50XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgc2V0Q2FsZW5kYXIoc3RhdGUsIG5hbWUsIGNhbGVuZGFyKSB7XHJcbiAgICAgICAgaWYgKHBpY2t5LmlzVmFsaWRQaWNreShzdGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgY2FsZW5kYXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4uc3RhdGUuY2FsZW5kYXJzLFxyXG4gICAgICAgICAgICAgICAgICAgIC4uLntbbmFtZV0gOiBjYWxlbmRhcn1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXRHYXRlVmFsdWUoc3RhdGUsIGNvbnN0cmFpbnQpIHtcclxuICAgICAgICBjb25zdCBnYXRlID0gY29uc3RyYWludC5nYXRlO1xyXG4gICAgICAgIHN3aXRjaChnYXRlLnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnY2FsZW5kYXInOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmNhbGVuZGFyc1tnYXRlLmNhbGVuZGFyXVtnYXRlLnByb3BlcnR5XTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkYXRlJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBnYXRlLmRhdGU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNoZWNrQ29uc3RyYWludFZpb2xhdGlvbihzdGF0ZSwgY29uc3RyYWludCwgY2FsZW5kYXIsIHByb3BlcnR5LCB2YWx1ZSkge1xyXG4gICAgICAgIGlmIChjb25zdHJhaW50LmFnZW50LmNhbGVuZGFyID09PSBjYWxlbmRhciAmJiBjb25zdHJhaW50LmFnZW50LnByb3BlcnR5ID09PSBwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAvLyBJcyBhcHBsaWNhYmxlIGNvbnN0cmFpbnRcclxuICAgICAgICAgICAgY29uc3QgY29uc3RyYWludFZhbHVlID0gcGlja3kuZ2V0R2F0ZVZhbHVlKHN0YXRlLCBjb25zdHJhaW50KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlQmVmb3JlR2F0ZSA9IHV0aWwuYUJlZm9yZUIodmFsdWUsIGNvbnN0cmFpbnRWYWx1ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlQWZ0ZXJHYXRlID0gdXRpbC5hQWZ0ZXJCKHZhbHVlLCBjb25zdHJhaW50VmFsdWUpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZUVxdWFsR2F0ZSA9ICF2YWx1ZUJlZm9yZUdhdGUgJiYgIXZhbHVlQWZ0ZXJHYXRlO1xyXG5cclxuICAgICAgICAgICAgbGV0IHZhbHVlSXNWYWxpZDtcclxuICAgICAgICAgICAgc3dpdGNoIChjb25zdHJhaW50LmNvbXBhcmF0b3IpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJzwnOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlSXNWYWxpZCA9IHZhbHVlQmVmb3JlR2F0ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJzw9JzpcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUlzVmFsaWQgPSB2YWx1ZUJlZm9yZUdhdGUgfHwgdmFsdWVFcXVhbEdhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICc+JzpcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUlzVmFsaWQgPSB2YWx1ZUFmdGVyR2F0ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJz49JzpcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUlzVmFsaWQgPSB2YWx1ZUFmdGVyR2F0ZSB8fCB2YWx1ZUVxdWFsR2F0ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJz0nOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnPT0nOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnPT09JzpcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUlzVmFsaWQgPSB2YWx1ZUVxdWFsR2F0ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJyE9JzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJyE9PSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVJc1ZhbGlkID0gIXZhbHVlRXF1YWxHYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUlzVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHZhbHVlSXNWYWxpZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gVmFsdWUgZG9lc24ndCB2aW9sYXRlIGNvbnN0cmFpbnQuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvbnN0cmFpbnQuYmVoYXZpb3VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGltaXQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBjb25zdHJhaW5lZCB2YWx1ZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIGNvbnN0cmFpbnRWYWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2FuY2VsJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLmNhbGVuZGFyc1tjYWxlbmRhcl1bcHJvcGVydHldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLmNhbGVuZGFyc1tjYWxlbmRhcl1bcHJvcGVydHldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBJcyBub3QgYXBwbGljYWJsZSBjb25zdHJhaW50XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHZhbGlkYXRlQ2hhbmdlQWdhaW5zdENvbnN0cmFpbnRzKHN0YXRlLCBjYWxlbmRhck5hbWUsIHByb3BlcnR5LCB2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBzdGF0ZS5jb25zdHJhaW50cy5yZWR1Y2UoKGN1cnJlbnRWaWV3LCBjb25zdHJhaW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGlja3kuY2hlY2tDb25zdHJhaW50VmlvbGF0aW9uKHN0YXRlLCBjb25zdHJhaW50LCBjYWxlbmRhck5hbWUsIHByb3BlcnR5LCBjdXJyZW50Vmlldyk7XHJcbiAgICAgICAgfSwgdmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBzZXRDYWxlbmRhclZpZXcoc3RhdGUsIGNhbGVuZGFyTmFtZSwgdmlldykge1xyXG4gICAgICAgIGlmIChwaWNreS5pc1ZhbGlkUGlja3koc3RhdGUpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbmVkVmlldyA9IHBpY2t5LnZhbGlkYXRlQ2hhbmdlQWdhaW5zdENvbnN0cmFpbnRzKHN0YXRlLCBjYWxlbmRhck5hbWUsICd2aWV3Jywgdmlldyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcGlja3kuc2V0Q2FsZW5kYXIoc3RhdGUsIGNhbGVuZGFyTmFtZSwge1xyXG4gICAgICAgICAgICAgICAgLi4uc3RhdGUuY2FsZW5kYXJzW2NhbGVuZGFyTmFtZV0sXHJcbiAgICAgICAgICAgICAgICB2aWV3OiBjb25zdHJhaW5lZFZpZXdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBzZXRDYWxlbmRhclZpZXdEYXkoc3RhdGUsIG5hbWUsIGRheSkge1xyXG4gICAgICAgIGlmIChwaWNreS5pc1ZhbGlkUGlja3koc3RhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwaWNreS5zZXRDYWxlbmRhclZpZXcoc3RhdGUsIG5hbWUsIHtcclxuICAgICAgICAgICAgICAgIC4uLnN0YXRlLmNhbGVuZGFyc1tuYW1lXS52aWV3LFxyXG4gICAgICAgICAgICAgICAgZGF5OiBkYXlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBzZXRDYWxlbmRhclZpZXdNb250aChzdGF0ZSwgbmFtZSwgbW9udGgpIHtcclxuICAgICAgICBpZiAocGlja3kuaXNWYWxpZFBpY2t5KHN0YXRlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcGlja3kuc2V0Q2FsZW5kYXJWaWV3KHN0YXRlLCBuYW1lLCB7XHJcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5jYWxlbmRhcnNbbmFtZV0udmlldyxcclxuICAgICAgICAgICAgICAgIG1vbnRoOiBtb250aFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhdGljIHNldENhbGVuZGFyVmlld1llYXIoc3RhdGUsIG5hbWUsIHllYXIpIHtcclxuICAgICAgICBpZiAocGlja3kuaXNWYWxpZFBpY2t5KHN0YXRlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcGlja3kuc2V0Q2FsZW5kYXJWaWV3KHN0YXRlLCBuYW1lLCB7XHJcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5jYWxlbmRhcnNbbmFtZV0udmlldyxcclxuICAgICAgICAgICAgICAgIHllYXI6IHllYXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgc2V0Q2FsZW5kYXJTZWxlY3Rpb24oc3RhdGUsIG5hbWUsIHNlbGVjdGlvbikge1xyXG4gICAgICAgIGlmIChwaWNreS5pc1ZhbGlkUGlja3koc3RhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwaWNreS5zZXRDYWxlbmRhcihzdGF0ZSwgbmFtZSwge1xyXG4gICAgICAgICAgICAgICAgLi4uc3RhdGUuY2FsZW5kYXJzW25hbWVdLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb25cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBzZXRDYWxlbmRhclNlbGVjdGlvbkRheShzdGF0ZSwgbmFtZSwgZGF5KSB7XHJcbiAgICAgICAgaWYgKHBpY2t5LmlzVmFsaWRQaWNreShzdGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBpY2t5LnNldENhbGVuZGFyU2VsZWN0aW9uKHN0YXRlLCBuYW1lLCB7XHJcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5jYWxlbmRhcnNbbmFtZV0uc2VsZWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgZGF5OiBkYXlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXRpYyBzZXRDYWxlbmRhclNlbGVjdGlvbk1vbnRoKHN0YXRlLCBuYW1lLCBtb250aCkge1xyXG4gICAgICAgIGlmIChwaWNreS5pc1ZhbGlkUGlja3koc3RhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwaWNreS5zZXRDYWxlbmRhclNlbGVjdGlvbihzdGF0ZSwgbmFtZSwge1xyXG4gICAgICAgICAgICAgICAgLi4uc3RhdGUuY2FsZW5kYXJzW25hbWVdLnNlbGVjdGlvbixcclxuICAgICAgICAgICAgICAgIG1vbnRoOiBtb250aFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhdGljIHNldENhbGVuZGFyU2VsZWN0aW9uWWVhcihzdGF0ZSwgbmFtZSwgeWVhcikge1xyXG4gICAgICAgIGlmIChwaWNreS5pc1ZhbGlkUGlja3koc3RhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwaWNreS5zZXRDYWxlbmRhclNlbGVjdGlvbihzdGF0ZSwgbmFtZSwge1xyXG4gICAgICAgICAgICAgICAgLi4uc3RhdGUuY2FsZW5kYXJzW25hbWVdLnNlbGVjdGlvbixcclxuICAgICAgICAgICAgICAgIHllYXI6IHllYXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHN0YXRpYyBpc1ZhbGlkUGlja3koc3RhdGUpIHtcclxuICAgICAgICBpZih0eXBlb2Ygc3RhdGUgPT09IHR5cGVvZiB7fSAmJiB0eXBlb2Ygc3RhdGUuY2FsZW5kYXJzID09PSB0eXBlb2YgW10pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdObyB2YWxpZCBwaWNreSBkYXRhIHBhc3NlZCBpbi4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0Q2FsZW5kYXJNb250aFZpZXdEYXRhKHN0YXRlLCBuYW1lKSB7XHJcbiAgICAgICAgaWYgKHBpY2t5LmlzVmFsaWRQaWNreShzdGF0ZSkpIHtcclxuICAgICAgICAgICAgY29uc3QgY2FsZW5kYXIgPSBzdGF0ZS5jYWxlbmRhcnNbbmFtZV07XHJcbiAgICAgICAgICAgIGlmIChjYWxlbmRhcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdEYXRhSGVscGVycy5nZW5lcmF0ZU1vbnRoVmlld0RhdGEoY2FsZW5kYXIudmlldy5tb250aCwgY2FsZW5kYXIudmlldy55ZWFyKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVGhlcmUgaXMgbm8gY2FsZW5kYXIgd2l0aCB0aGUgbmFtZTogJHtuYW1lfSBpbiB0aGlzIHBpY2t5IG9iamVjdC5gKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldENhbGVuZGFyWWVhclZpZXdEYXRhKHN0YXRlLCBuYW1lKSB7XHJcbiAgICAgICAgaWYgKHBpY2t5LmlzVmFsaWRQaWNreShzdGF0ZSkpIHtcclxuICAgICAgICAgICAgY29uc3QgY2FsZW5kYXIgPSBzdGF0ZS5jYWxlbmRhcnNbbmFtZV07XHJcbiAgICAgICAgICAgIGlmIChjYWxlbmRhcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdEYXRhSGVscGVycy5nZW5lcmF0ZVllYXJWaWV3RGF0YShjYWxlbmRhci52aWV3LnllYXIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBUaGVyZSBpcyBubyBjYWxlbmRhciB3aXRoIHRoZSBuYW1lOiAke25hbWV9IGluIHRoaXMgcGlja3kgb2JqZWN0LmApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgbW92ZUNhbGVuZGFyVmlld0ZvcndhcmRPbmVNb250aChzdGF0ZSwgbmFtZSkge1xyXG4gICAgICAgIGlmIChwaWNreS5pc1ZhbGlkUGlja3koc3RhdGUpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbGVuZGFyID0gc3RhdGUuY2FsZW5kYXJzW25hbWVdO1xyXG4gICAgICAgICAgICBpZiAoY2FsZW5kYXIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwaWNreS5zZXRDYWxlbmRhclZpZXcoc3RhdGUsIG5hbWUsIHV0aWwuZ2V0RGF0ZU9mRm9sbG93aW5nTW9udGgoY2FsZW5kYXIudmlldykpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBUaGVyZSBpcyBubyBjYWxlbmRhciB3aXRoIHRoZSBuYW1lOiAke25hbWV9IGluIHRoaXMgcGlja3kgb2JqZWN0LmApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgbW92ZUNhbGVuZGFyVmlld0JhY2t3YXJkT25lTW9udGgoc3RhdGUsIG5hbWUpIHtcclxuICAgICAgICBpZiAocGlja3kuaXNWYWxpZFBpY2t5KHN0YXRlKSkge1xyXG4gICAgICAgICAgICBjb25zdCBjYWxlbmRhciA9IHN0YXRlLmNhbGVuZGFyc1tuYW1lXTtcclxuICAgICAgICAgICAgaWYgKGNhbGVuZGFyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGlja3kuc2V0Q2FsZW5kYXJWaWV3KHN0YXRlLCBuYW1lLCB1dGlsLmdldERhdGVPZlByZWNlZGluZ01vbnRoKGNhbGVuZGFyLnZpZXcpKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVGhlcmUgaXMgbm8gY2FsZW5kYXIgd2l0aCB0aGUgbmFtZTogJHtuYW1lfSBpbiB0aGlzIHBpY2t5IG9iamVjdC5gKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldENhbGVuZGFyVmlld0RhdGEoc3RhdGUsIG5hbWUpIHtcclxuICAgICAgICBpZiAocGlja3kuaXNWYWxpZFBpY2t5KHN0YXRlKSkge1xyXG4gICAgICAgICAgICBjb25zdCBjYWxlbmRhciA9IHN0YXRlLmNhbGVuZGFyc1tuYW1lXTtcclxuICAgICAgICAgICAgaWYgKGNhbGVuZGFyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmlld0RhdGFIZWxwZXJzLmdlbmVyYXRlTW9udGhWaWV3RGF0YShjYWxlbmRhci52aWV3Lm1vbnRoLCBjYWxlbmRhci52aWV3LnllYXIsIG51bGwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBUaGVyZSBpcyBubyBjYWxlbmRhciB3aXRoIHRoZSBuYW1lOiAke25hbWV9IGluIHRoaXMgcGlja3kgb2JqZWN0LmApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHN0YXRpYyBjcmVhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY2FsZW5kYXJzOiB7fSxcclxuICAgICAgICAgICAgY29uc3RyYWludHM6IFtdLFxyXG4gICAgICAgICAgICB2aWV3TW9kZTogJ21vbnRoJ1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcGlja3k7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5jbGFzcyB1dGlsIHtcclxuICAgIHN0YXRpYyBpc0xlYXBZZWFyKHllYXIpIHtcclxuICAgICAgICBpZiAoeWVhciU0ICE9PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2UgaWYgKHllYXIlMTAwICE9PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoeWVhciU0MDAgIT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYUJlZm9yZUIoYSwgYikge1xyXG4gICAgICAgIHJldHVybiBhLnllYXIgPCBiLnllYXJcclxuICAgICAgICAgICAgfHwgYS55ZWFyID09PSBiLnllYXIgJiYgYS5tb250aCA8IGIubW9udGhcclxuICAgICAgICAgICAgfHwgYS55ZWFyID09PSBiLnllYXIgJiYgYS5tb250aCA9PT0gYi5tb250aCAmJiBhLmRheSA8IGIuZGF5O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhQWZ0ZXJCKGEsIGIpIHtcclxuICAgICAgICByZXR1cm4gYS55ZWFyID4gYi55ZWFyXHJcbiAgICAgICAgICAgIHx8IGEueWVhciA9PT0gYi55ZWFyICYmIGEubW9udGggPiBiLm1vbnRoXHJcbiAgICAgICAgICAgIHx8IGEueWVhciA9PT0gYi55ZWFyICYmIGEubW9udGggPT09IGIubW9udGggJiYgYS5kYXkgPiBiLmRheTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgc3RhdGljIGdldFdlZWtkYXkoZGF5LCBtb250aCwgeWVhcikge1xyXG4gICAgICAgIC8vIEltcGxlbWVudGluZyBaZWxsZXIncyBjb25ncnVlbmNlXHJcbiAgICAgICAgLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvWmVsbGVyJTI3c19jb25ncnVlbmNlXHJcblxyXG4gICAgICAgIGNvbnN0IHEgPSBkYXk7XHJcbiAgICAgICAgbGV0IG07XHJcbiAgICAgICAgbGV0IHBvdGVudGlhbGx5U2hpZnRlZFllYXI7XHJcbiAgICAgICAgaWYgKG1vbnRoIDw9IDIpIHtcclxuICAgICAgICAgICAgbSA9IG1vbnRoKzEyO1xyXG4gICAgICAgICAgICBwb3RlbnRpYWxseVNoaWZ0ZWRZZWFyID0geWVhci0xO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG0gPSBtb250aDtcclxuICAgICAgICAgICAgcG90ZW50aWFsbHlTaGlmdGVkWWVhciA9IHllYXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IEsgPSBwb3RlbnRpYWxseVNoaWZ0ZWRZZWFyICUgMTAwO1xyXG4gICAgICAgIGNvbnN0IEogPSBNYXRoLmZsb29yKHBvdGVudGlhbGx5U2hpZnRlZFllYXIgLyAxMDApO1xyXG5cclxuICAgICAgICBjb25zdCBoID0gKHEgKyBNYXRoLmZsb29yKDEzKihtICsgMSkgLyA1KSArIEsgKyBNYXRoLmZsb29yKEsvNCkgKyBNYXRoLmZsb29yKEovNCkgKyA1KkopICUgNztcclxuXHJcbiAgICAgICAgY29uc3QgZCA9ICgoaCs1KSAlIDcpO1xyXG4gICAgICAgIHJldHVybiBkO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXRGb2xsb3dpbmdNb250aE51bWJlcihtb250aCkge1xyXG4gICAgICAgIGlmIChtb250aCA9PT0gMTIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG1vbnRoICsgMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldFByZWNlZGluZ01vbnRoTnVtYmVyKG1vbnRoKSB7XHJcbiAgICAgICAgaWYgKG1vbnRoID09PSAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxMjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbW9udGggLSAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0RGF0ZU9mRm9sbG93aW5nTW9udGgoZGF0ZSkge1xyXG4gICAgICAgIGNvbnN0IGZvbGxvd2luZ01vbnRoID0gdXRpbC5nZXRGb2xsb3dpbmdNb250aE51bWJlcihkYXRlLm1vbnRoKTtcclxuICAgICAgICBjb25zdCB5ZWFyT2ZGb2xsb3dpbmdNb250aCA9IGZvbGxvd2luZ01vbnRoID09PSAxID8gZGF0ZS55ZWFyKzEgOiBkYXRlLnllYXI7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGRheTogTWF0aC5taW4oZGF0ZS5kYXksIHV0aWwuZ2V0RGF5c0luTW9udGgoZm9sbG93aW5nTW9udGgsIHllYXJPZkZvbGxvd2luZ01vbnRoKSksXHJcbiAgICAgICAgICAgIG1vbnRoOiBmb2xsb3dpbmdNb250aCxcclxuICAgICAgICAgICAgeWVhcjogeWVhck9mRm9sbG93aW5nTW9udGhcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXREYXRlT2ZQcmVjZWRpbmdNb250aChkYXRlKSB7XHJcbiAgICAgICAgY29uc3QgcHJlY2VkaW5nTW9udGggPSB1dGlsLmdldFByZWNlZGluZ01vbnRoTnVtYmVyKGRhdGUubW9udGgpO1xyXG4gICAgICAgIGNvbnN0IHllYXJPZlByZWNlZGluZ01vbnRoID0gcHJlY2VkaW5nTW9udGggPT09IDEyID8gZGF0ZS55ZWFyLTEgOiBkYXRlLnllYXI7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGRheTogTWF0aC5taW4oZGF0ZS5kYXksIHV0aWwuZ2V0RGF5c0luTW9udGgocHJlY2VkaW5nTW9udGgsIHllYXJPZlByZWNlZGluZ01vbnRoKSksXHJcbiAgICAgICAgICAgIG1vbnRoOiBwcmVjZWRpbmdNb250aCxcclxuICAgICAgICAgICAgeWVhcjogeWVhck9mUHJlY2VkaW5nTW9udGhcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXREYXlzSW5Nb250aChtb250aCwgeWVhcikge1xyXG4gICAgICAgIGNvbnN0IG1vbnRoTGVuZ3RocyA9IFtcclxuICAgICAgICAgICAgMzEsIHV0aWwuaXNMZWFwWWVhcih5ZWFyKSA/IDI5IDogMjgsIDMxLCAzMCwgMzEsIDMwLCAzMSwgMzEsIDMwLCAzMSwgMzAsIDMxXHJcbiAgICAgICAgXTtcclxuICAgICAgICByZXR1cm4gbW9udGhMZW5ndGhzW21vbnRoLTFdO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHV0aWw7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5pbXBvcnQgdXRpbCBmcm9tICcuL3V0aWwnO1xyXG5cclxuY2xhc3Mgdmlld0RhdGFIZWxwZXJzIHtcclxuXHJcbiAgICBzdGF0aWMgY3JlYXRlRGF5T2JqZWN0KGRheSwgd2Vla2RheSwgbW9udGgsIHllYXIsIGNvbnN0cmFpbnRzKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IGRheU9iaiA9IHtcclxuICAgICAgICAgICAgZGF5LCB3ZWVrZGF5LCBtb250aCwgeWVhclxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZpZXdEYXRhSGVscGVycy5nZXREYXRlQ29tcGFyYXRpdmVzKClcclxuXHJcbiAgICAgICAgcmV0dXJuIGRheU9iajtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2VuZXJhdGVZZWFyVmlld0RhdGEoeWVhcikge1xyXG4gICAgICAgIGNvbnN0IGlzTGVhcFllYXIgPSB1dGlsLmlzTGVhcFllYXIoeWVhcik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgeWVhcjogeWVhcixcclxuICAgICAgICAgICAgaXNMZWFwWWVhcjogaXNMZWFwWWVhcixcclxuICAgICAgICAgICAgbnVtYmVyT2ZEYXlzOiBpc0xlYXBZZWFyID8gMzY2OiAzNjUsXHJcbiAgICAgICAgICAgIG1vbnRoczogKG5ldyBBcnJheSgxMikpXHJcbiAgICAgICAgICAgICAgICAgICAgLmZpbGwoMClcclxuICAgICAgICAgICAgICAgICAgICAubWFwKCh2YWx1ZSwgaW5kZXgpID0+IGluZGV4KzEpXHJcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgobW9udGhOdW1iZXIpICA9PiB2aWV3RGF0YUhlbHBlcnMuZ2VuZXJhdGVNb250aFZpZXdEYXRhKG1vbnRoTnVtYmVyLCB5ZWFyKSlcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXREYXRlQ29tcGFyYXRpdmVzKGRhdGUsIGNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgLy8gSW1wbGVtZW50IHN0dWZmIGZyb20gY2hlY2tDb25zdHJhaW50VmlvbGF0aW9uXHJcbiAgICAgICAgLy8gcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdlbmVyYXRlTW9udGhWaWV3RGF0YShtb250aCwgeWVhciwgY29uc3RyYWludHMpIHtcclxuICAgICAgICBjb25zdCBzdGFydFdlZWtkYXkgPSB1dGlsLmdldFdlZWtkYXkoMSwgbW9udGgsIHllYXIpO1xyXG5cclxuICAgICAgICBjb25zdCBwcmVjZWRpbmdNb250aCA9IHV0aWwuZ2V0UHJlY2VkaW5nTW9udGhOdW1iZXIobW9udGgpO1xyXG4gICAgICAgIGNvbnN0IHllYXJPZlByZWNlZGluZ01vbnRoID0gcHJlY2VkaW5nTW9udGggPT09IDEyID8geWVhci0xIDogeWVhcjtcclxuICAgICAgICBjb25zdCBkYXlzSW5QcmVjZWRpbmdNb250aCA9IHV0aWwuZ2V0RGF5c0luTW9udGgocHJlY2VkaW5nTW9udGgsIHllYXIpO1xyXG5cclxuICAgICAgICBjb25zdCBmb2xsb3dpbmdNb250aCA9IHV0aWwuZ2V0Rm9sbG93aW5nTW9udGhOdW1iZXIobW9udGgpO1xyXG4gICAgICAgIGNvbnN0IHllYXJPZkZvbGxvd2luZ01vbnRoID0gZm9sbG93aW5nTW9udGggPT09IDEgPyB5ZWFyKzEgOiB5ZWFyO1xyXG5cclxuICAgICAgICBjb25zdCBkYXlzSW5DdXJyZW50TW9udGggPSB1dGlsLmdldERheXNJbk1vbnRoKG1vbnRoLCB5ZWFyKTtcclxuXHJcbiAgICAgICAgY29uc3Qgd2Vla3MgPSBbXTtcclxuXHJcbiAgICAgICAgbGV0IGN1cnJlbnREYXRlID0gMTtcclxuICAgICAgICBsZXQgY3VycmVudFdlZWtJbmRleCA9IDA7XHJcbiAgICAgICAgbGV0IGN1cnJlbnREYXlJbkZvbGxvd2luZ01vbnRoID0gMTtcclxuXHJcbiAgICAgICAgd2Vla3NbY3VycmVudFdlZWtJbmRleF0gPSBbXTtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGFydFdlZWtkYXk7IGkrKykge1xyXG4gICAgICAgICAgICB3ZWVrc1tjdXJyZW50V2Vla0luZGV4XS5wdXNoKHZpZXdEYXRhSGVscGVycy5jcmVhdGVEYXlPYmplY3QoXHJcbiAgICAgICAgICAgICAgICBkYXlzSW5QcmVjZWRpbmdNb250aCAtIHN0YXJ0V2Vla2RheSArIDEgKyBpLFxyXG4gICAgICAgICAgICAgICAgaSxcclxuICAgICAgICAgICAgICAgIHByZWNlZGluZ01vbnRoLFxyXG4gICAgICAgICAgICAgICAgeWVhck9mUHJlY2VkaW5nTW9udGgsXHJcbiAgICAgICAgICAgICAgICBjb25zdHJhaW50c1xyXG4gICAgICAgICAgICApKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgd2hpbGUod2Vla3NbY3VycmVudFdlZWtJbmRleF0ubGVuZ3RoIDwgNyB8fCBjdXJyZW50RGF0ZSA8PSBkYXlzSW5DdXJyZW50TW9udGgpIHtcclxuICAgICAgICAgICAgaWYod2Vla3NbY3VycmVudFdlZWtJbmRleF0ubGVuZ3RoID09PSA3KSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50V2Vla0luZGV4Kys7XHJcbiAgICAgICAgICAgICAgICB3ZWVrc1tjdXJyZW50V2Vla0luZGV4XSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGN1cnJlbnREYXRlIDw9IGRheXNJbkN1cnJlbnRNb250aCkge1xyXG4gICAgICAgICAgICAgICAgd2Vla3NbY3VycmVudFdlZWtJbmRleF0ucHVzaCh2aWV3RGF0YUhlbHBlcnMuY3JlYXRlRGF5T2JqZWN0KFxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnREYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgIHdlZWtzW2N1cnJlbnRXZWVrSW5kZXhdLmxlbmd0aCsxLFxyXG4gICAgICAgICAgICAgICAgICAgIG1vbnRoLFxyXG4gICAgICAgICAgICAgICAgICAgIHllYXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludHNcclxuICAgICAgICAgICAgICAgICkpO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudERhdGUrKztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHdlZWtzW2N1cnJlbnRXZWVrSW5kZXhdLnB1c2godmlld0RhdGFIZWxwZXJzLmNyZWF0ZURheU9iamVjdChcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGF5SW5Gb2xsb3dpbmdNb250aCxcclxuICAgICAgICAgICAgICAgICAgICB3ZWVrc1tjdXJyZW50V2Vla0luZGV4XS5sZW5ndGgrMSxcclxuICAgICAgICAgICAgICAgICAgICBmb2xsb3dpbmdNb250aCxcclxuICAgICAgICAgICAgICAgICAgICB5ZWFyT2ZGb2xsb3dpbmdNb250aCxcclxuICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW50c1xyXG4gICAgICAgICAgICAgICAgKSk7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50RGF5SW5Gb2xsb3dpbmdNb250aCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG1vbnRoOiBtb250aCxcclxuICAgICAgICAgICAgeWVhcjogeWVhcixcclxuICAgICAgICAgICAgd2Vla3M6IHdlZWtzLFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gdmlld0RhdGFIZWxwZXJzOyJdfQ==
